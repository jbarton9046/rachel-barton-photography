<!-- Top nav -->
<div class="topbar container">
  <!-- brand (kept empty in your markup; link added for tap target) -->
  <a class="brand" href="/" aria-label="Home"></a>

  <!-- mobile toggle (checkbox hack = no JS) -->
  <input id="navchk" class="navchk" type="checkbox" aria-hidden="true" />
  <label for="navchk" class="nav-toggle" aria-label="Open menu" role="button" aria-controls="site-menu" aria-expanded="false">
    <span class="bar"></span><span class="bar"></span><span class="bar"></span>
  </label>

  <nav class="primary" id="site-menu" aria-label="Primary">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/about.html">Meet Rachel</a></li>

      <li class="has-sub">
        <a href="/galleries.html" aria-haspopup="true" aria-expanded="false">Galleries</a>
        <ul class="dropdown" aria-label="Galleries submenu">
          <li><a href="/portraits.html">Portraits</a></li>
          <li><a href="/branding.html">Branding</a></li>
          <li><a href="/events.html">Events</a></li>
        </ul>
      </li>

      <li><a href="/testimonials.html">Testimonials</a></li>
      <li><a href="/faq.html">FAQ</a></li>
      <li><a href="/contact.html">Contact</a></li>
      <li><a href="/book.html">Book</a></li>
    </ul>
  </nav>
</div>

<script>
  (function () {
    const chk = document.getElementById('navchk');
    if (!chk) return;

    // Elements to push when the drawer is open (JS safety net)
    const targets = () => [
      document.getElementById('content'),
      document.querySelector('[data-include="/partials/footer.html"]'),
      document.querySelector('.hero')
    ].filter(Boolean);

    const applyShift = (on) => {
      const tx = on ? 'translateX(var(--drawer-w))' : '';
      for (const el of targets()) el.style.transform = tx;
    };

    const sync = () => {
      // Body class for CSS fallback + ARIA state for the toggle
      document.body.classList.toggle('drawer-open', chk.checked);
      const label = document.querySelector('label[for="navchk"]');
      if (label) label.setAttribute('aria-expanded', String(chk.checked));

      // Ensure the page always displaces even if :has() isn't supported
      applyShift(chk.checked);
    };

    // Close drawer when a nav link is clicked (nice UX)
    const nav = document.getElementById('site-menu');
    if (nav) {
      nav.addEventListener('click', (e) => {
        const a = e.target.closest('a');
        if (a) {
          chk.checked = false;
          sync();
        }
      });
    }

    // ✅ Outside-click close WITHOUT blocking page buttons/links
    // If drawer is open and the click is outside nav/label, close it,
    // but do NOT stop the click — the underlying button/link still works.
    document.addEventListener('click', (e) => {
      if (!chk.checked) return; // drawer not open → ignore
      if (e.target.closest('nav.primary') || e.target.closest('label[for="navchk"]')) return;
      chk.checked = false;
      sync();
      // don't preventDefault — allow the original click to continue
    }, true); // capture to run before navigation mutates the DOM

    // Esc key closes the drawer
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && chk.checked) {
        chk.checked = false;
        sync();
      }
    });

    chk.addEventListener('change', sync);

    // Initial sync in case the partial loads after initial render
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', sync);
    } else {
      requestAnimationFrame(sync);
    }
  })();
</script>
